{% import "utils.html" as utils %}
<form method="POST" action="/user/{{ userid }}/schan">
  <h2 class="text-center">私有签到框架<sup>alpha</sup></h2>
  <hr>
  {% if task.disabled %}
  <p class="alert alert-danger">任务处于禁用状态，使用 <a class="modal_load alert-link" href="/task/{{ task.id }}/run">立即执行</a> 成功签到一次，即可解除。</p>
  {% endif %}

  <div id="run-result"></div>

  {% if current_user %}
  <div class="form-group">
    <label class="control-label" for="note">S酱</label>
	<!-- MY页面-添加签到-增加提示语 -->
    <input type="text" class="form-control" name="skey" value="" id="skey" placeholder="最后不要带.send">
	<!-- MY页面-添加签到-增加备注图标 -->
	<span class="glyphicon glyphicon-file form-control-feedback" aria-hidden="true"></span>
	
  </div>
  {% endif %}

  <div class="text-right">
    <button id="testschan" name="testschan" data-loading-text="loading..." class="btn btn-default">测试</button>
    <button id="send" name="send" type="submit" data-loading-text="loading..." class="btn btn-primary">提交</button>
  </div>
  <script>
    $(function() {
      // 测试链接
      $('#test').on('click', function() {
        var burl = document.getElementById("skey");
        var data = {
          url:burl,
          "test":1
        }
        var $this = $(this);
        $this.button('loading');
        $.ajax("/user/{{ userid }}/schan", {
          type: 'POST',
          data: data,
        })
        .done(function(data) {
          $('#run-result').html(data).show()
        })
        .fail(function(jxhr) {
          $('#run-result').html('<h1 class="alert alert-danger text-center">设置失败</h1><div class="well"></div>').show().find('div').text(jxhr.responseText);
        })
        .always(function() {
          $this.button('reset');
        });

        return false;
      });
    })
  </script>
    <script>
      $(function() {
        // 测试链接
        $('#submit').on('click', function() {
          var burl = document.getElementById("skey");
          var data = {
            url:burl,
            "send":1
          }
          var $this = $(this);
          $this.button('loading');
          $.ajax("/user/{{ userid }}/schan", {
            type: 'POST',
            data: data,
          })
          .done(function(data) {
            $('#run-result').html(data).show()
          })
          .fail(function(jxhr) {
            $('#run-result').html('<h1 class="alert alert-danger text-center">设置失败</h1><div class="well"></div>').show().find('div').text(jxhr.responseText);
          })
          .always(function() {
            $this.button('reset');
          });
  
          return false;
        });
      })
    </script>

  {{ utils.task_new_scripts() }}
  {{ utils.submit_loading() }}
</form>
